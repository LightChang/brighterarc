<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ”¿ç­–æ‰¿è«¾è¿½è¹¤ - BrighterArc</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* å´é‚Šæ¬„ */
    .sidebar {
      width: 320px;
      background: #fff;
      border-right: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .sidebar-header h1 {
      font-size: 1.25rem;
      margin-bottom: 10px;
    }

    .stats {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 0.85rem;
    }

    .stat {
      padding: 4px 8px;
      border-radius: 4px;
      background: #f0f0f0;
    }

    .stat.tracking { background: #e3f2fd; color: #1565c0; }
    .stat.fulfilled { background: #e8f5e9; color: #2e7d32; }
    .stat.delayed { background: #fff3e0; color: #ef6c00; }
    .stat.stale { background: #fafafa; color: #757575; }

    /* ç¯©é¸å™¨ */
    .filters {
      padding: 15px 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .filter-group {
      margin-bottom: 10px;
    }

    .filter-group:last-child {
      margin-bottom: 0;
    }

    .filter-group label {
      display: block;
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 5px;
    }

    .filter-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    /* æ‰¿è«¾åˆ—è¡¨ */
    .commitment-list {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }

    .category-section {
      margin-bottom: 15px;
    }

    .category-header {
      font-size: 0.85rem;
      font-weight: 600;
      color: #666;
      padding: 8px 10px;
      background: #f9f9f9;
      border-radius: 4px;
      margin-bottom: 5px;
    }

    .commitment-item {
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      margin-bottom: 5px;
    }

    .commitment-item:hover {
      background: #f5f5f5;
    }

    .commitment-item.active {
      background: #e3f2fd;
    }

    .commitment-title {
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 5px;
    }

    .commitment-meta {
      font-size: 0.8rem;
      color: #666;
      display: flex;
      gap: 10px;
    }

    .status-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.75rem;
    }

    .status-badge.è¿½è¹¤ä¸­ { background: #e3f2fd; color: #1565c0; }
    .status-badge.å·²é”æˆ { background: #e8f5e9; color: #2e7d32; }
    .status-badge.å·²å»¶å®• { background: #fff3e0; color: #ef6c00; }
    .status-badge.ç„¡æ›´æ–° { background: #fafafa; color: #757575; }

    /* ä¸»å…§å®¹å€ */
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .empty-state {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
      font-size: 1.1rem;
    }

    .commitment-detail {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .commitment-detail h1 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .commitment-detail h2 {
      font-size: 1.2rem;
      margin: 25px 0 15px;
      color: #333;
    }

    .commitment-detail h3 {
      font-size: 1rem;
      margin: 20px 0 10px;
      color: #555;
    }

    .commitment-detail p {
      margin-bottom: 15px;
    }

    .commitment-detail strong {
      color: #333;
    }

    .detail-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 6px;
    }

    .meta-item {
      font-size: 0.9rem;
    }

    .meta-item .label {
      color: #666;
      display: block;
      margin-bottom: 3px;
    }

    .meta-item .value {
      font-weight: 500;
    }

    /* è¼‰å…¥ç‹€æ…‹ */
    .loading {
      text-align: center;
      padding: 50px;
      color: #666;
    }

    .error {
      text-align: center;
      padding: 50px;
      color: #c62828;
    }

    /* RWD */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        max-height: 50vh;
      }

      .main-content {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å´é‚Šæ¬„ -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h1>ğŸ“‹ æ”¿ç­–æ‰¿è«¾è¿½è¹¤</h1>
        <div class="stats" id="stats">
          <span class="stat">è¼‰å…¥ä¸­...</span>
        </div>
      </div>

      <div class="filters">
        <div class="filter-group">
          <label>ç‹€æ…‹ç¯©é¸</label>
          <select id="statusFilter">
            <option value="">å…¨éƒ¨ç‹€æ…‹</option>
            <option value="è¿½è¹¤ä¸­">â³ è¿½è¹¤ä¸­</option>
            <option value="å·²é”æˆ">âœ… å·²é”æˆ</option>
            <option value="å·²å»¶å®•">âš ï¸ å·²å»¶å®•</option>
            <option value="ç„¡æ›´æ–°">ğŸ’¤ ç„¡æ›´æ–°</option>
          </select>
        </div>
        <div class="filter-group">
          <label>åˆ†é¡ç¯©é¸</label>
          <select id="categoryFilter">
            <option value="">å…¨éƒ¨åˆ†é¡</option>
          </select>
        </div>
      </div>

      <div class="commitment-list" id="commitmentList">
        <div class="loading">è¼‰å…¥ä¸­...</div>
      </div>
    </div>

    <!-- ä¸»å…§å®¹å€ -->
    <div class="main-content" id="mainContent">
      <div class="empty-state">
        ğŸ‘ˆ è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹æ‰¿è«¾
      </div>
    </div>
  </div>

  <script>
    let indexData = null;
    let currentCommitment = null;

    // è¼‰å…¥ç´¢å¼•
    async function loadIndex() {
      try {
        const response = await fetch('commitments/index.json');
        if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥ç´¢å¼•');
        indexData = await response.json();
        renderStats();
        renderFilters();
        renderList();
      } catch (error) {
        document.getElementById('commitmentList').innerHTML =
          `<div class="error">âŒ ${error.message}</div>`;
      }
    }

    // æ¸²æŸ“çµ±è¨ˆ
    function renderStats() {
      const stats = indexData.status_summary;
      document.getElementById('stats').innerHTML = `
        <span class="stat tracking">â³ ${stats['è¿½è¹¤ä¸­'] || 0}</span>
        <span class="stat fulfilled">âœ… ${stats['å·²é”æˆ'] || 0}</span>
        <span class="stat delayed">âš ï¸ ${stats['å·²å»¶å®•'] || 0}</span>
        <span class="stat stale">ğŸ’¤ ${stats['ç„¡æ›´æ–°'] || 0}</span>
      `;
    }

    // æ¸²æŸ“ç¯©é¸å™¨
    function renderFilters() {
      const categoryFilter = document.getElementById('categoryFilter');
      indexData.categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat.name;
        option.textContent = `${cat.name} (${cat.count})`;
        categoryFilter.appendChild(option);
      });
    }

    // æ¸²æŸ“åˆ—è¡¨
    function renderList() {
      const statusFilter = document.getElementById('statusFilter').value;
      const categoryFilter = document.getElementById('categoryFilter').value;

      let html = '';

      indexData.categories.forEach(category => {
        if (categoryFilter && category.name !== categoryFilter) return;

        const filteredCommitments = category.commitments.filter(c =>
          !statusFilter || c.status === statusFilter
        );

        if (filteredCommitments.length === 0) return;

        html += `
          <div class="category-section">
            <div class="category-header">${category.name} (${filteredCommitments.length})</div>
            ${filteredCommitments.map(c => `
              <div class="commitment-item" data-file="${c.file}" onclick="loadCommitment('${c.file}')">
                <div class="commitment-title">${c.title}</div>
                <div class="commitment-meta">
                  <span class="status-badge ${c.status}">${c.status}</span>
                  ${c.target_date ? `<span>ğŸ“… ${c.target_date}</span>` : ''}
                </div>
              </div>
            `).join('')}
          </div>
        `;
      });

      document.getElementById('commitmentList').innerHTML = html ||
        '<div class="empty-state">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„æ‰¿è«¾</div>';
    }

    // è¼‰å…¥æ‰¿è«¾è©³æƒ…
    async function loadCommitment(file) {
      try {
        // æ›´æ–°é¸ä¸­ç‹€æ…‹
        document.querySelectorAll('.commitment-item').forEach(el => {
          el.classList.remove('active');
        });
        document.querySelector(`[data-file="${file}"]`)?.classList.add('active');

        // è¼‰å…¥ Markdown
        const response = await fetch(`commitments/${file}`);
        if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥æ‰¿è«¾');
        const markdown = await response.text();

        // è§£æ frontmatter
        const frontmatterMatch = markdown.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
        if (!frontmatterMatch) throw new Error('æ ¼å¼éŒ¯èª¤');

        const frontmatter = parseFrontmatter(frontmatterMatch[1]);
        const content = frontmatterMatch[2];

        // æ¸²æŸ“è©³æƒ…
        renderDetail(frontmatter, content);
      } catch (error) {
        document.getElementById('mainContent').innerHTML =
          `<div class="error">âŒ ${error.message}</div>`;
      }
    }

    // è§£æ frontmatter
    function parseFrontmatter(yaml) {
      const result = {};
      yaml.split('\n').forEach(line => {
        const match = line.match(/^(\w+):\s*"?([^"]*)"?$/);
        if (match) {
          result[match[1]] = match[2];
        }
      });
      return result;
    }

    // æ¸²æŸ“è©³æƒ…
    function renderDetail(meta, content) {
      const statusIcons = {
        'è¿½è¹¤ä¸­': 'â³',
        'å·²é”æˆ': 'âœ…',
        'å·²å»¶å®•': 'âš ï¸',
        'ç„¡æ›´æ–°': 'ğŸ’¤'
      };

      document.getElementById('mainContent').innerHTML = `
        <div class="commitment-detail">
          <h1>${statusIcons[meta.status] || ''} ${meta.title}</h1>

          <div class="detail-meta">
            <div class="meta-item">
              <span class="label">ç‹€æ…‹</span>
              <span class="value status-badge ${meta.status}">${meta.status}</span>
            </div>
            <div class="meta-item">
              <span class="label">åˆ†é¡</span>
              <span class="value">${meta.category}</span>
            </div>
            ${meta.target_date && meta.target_date !== 'null' ? `
            <div class="meta-item">
              <span class="label">ç›®æ¨™æ—¥æœŸ</span>
              <span class="value">${meta.target_date}</span>
            </div>
            ` : ''}
            ${meta.target_value && meta.target_value !== 'null' ? `
            <div class="meta-item">
              <span class="label">ç›®æ¨™å€¼</span>
              <span class="value">${meta.target_value}</span>
            </div>
            ` : ''}
            ${meta.responsible_agency && meta.responsible_agency !== 'null' ? `
            <div class="meta-item">
              <span class="label">è² è²¬æ©Ÿé—œ</span>
              <span class="value">${meta.responsible_agency}</span>
            </div>
            ` : ''}
            <div class="meta-item">
              <span class="label">æœ€å¾Œæ›´æ–°</span>
              <span class="value">${meta.last_updated}</span>
            </div>
          </div>

          ${marked.parse(content)}
        </div>
      `;
    }

    // äº‹ä»¶ç›£è½
    document.getElementById('statusFilter').addEventListener('change', renderList);
    document.getElementById('categoryFilter').addEventListener('change', renderList);

    // åˆå§‹åŒ–
    loadIndex();
  </script>
</body>
</html>
